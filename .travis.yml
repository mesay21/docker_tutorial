sudo: required ## root access is required
language: generic

services:
  - docker ## need copy of docker ready

before_install: #steps that need to occur before the test/deployment is run
  - docker build -t mesayb/docker-tutorial -f ./src/frontend/Dockerfile.dev src/frontend/
  - docker build -t mesayb/multi-docker-app -f ./src/complex/client/Dockerfile.dev ./src/complex/client

script: #commands to be run for the test to be executed
  - docker run -e CI=true mesayb/docker-tutorial npm run test -- --coverage
  - docker run -e CI=true mesayb/multi-docker-app npm run test -- --coverage

after_success:
  - docker build -t mesayb/multi-client ./src/complex/client
  - docker build -t mesayb/multi-nginx ./src/complex/nginx
  - docker build -t mesayb/multi-server ./src/complex/server
  - docker build -t mesayb/multi-worker ./src/complex/worker

  #login to docker cli and push to docker hub
  - echo "$DOCKER_PWD" | docker login -u "$DOCKER_ID" --password-stdin
  - docker push mesayb/multi-client
  - docker push mesayb/multi-nginx
  - docker push mesayb/multi-server
  - docker push mesayb/multi-worker